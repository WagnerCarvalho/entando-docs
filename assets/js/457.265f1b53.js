(window.webpackJsonp=window.webpackJsonp||[]).push([[457],{1369:function(e,t,n){"use strict";n.r(t);var a=n(32),o=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"entando-custom-resources-for-kubernetes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entando-custom-resources-for-kubernetes"}},[e._v("#")]),e._v(" Entando Custom Resources for Kubernetes")]),e._v(" "),n("h2",{attrs:{id:"objective"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#objective"}},[e._v("#")]),e._v(" Objective")]),e._v(" "),n("p",[e._v("This is an overview of Entando Kubernetes Custom Resources and their usage on the Entando Platform.")]),e._v(" "),n("h2",{attrs:{id:"prerequisites"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),n("ul",[n("li",[e._v("Basic knowledge of Kubernetes and how to deploy Docker images")])]),e._v(" "),n("h2",{attrs:{id:"overview"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),n("p",[e._v("Amongst its many features, Kubernetes comes with a REST API for dozens of different resource types.\nGenerally these APIs offer full Create/Retrieve/Update/Delete (CRUD) access to each of the resource types. We\ntypically format these resources in YAML or JSON and use commandline tools such as\n"),n("code",[e._v("kubectl")]),e._v(" or "),n("code",[e._v("oc")]),e._v(" to manage them. Each of these resources has a clearly defined structure")]),e._v(" "),n("p",[e._v("that is well documented in the "),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes API"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("Kubernetes  also allows clients to subscribe to events generated as these resources get updated. These subscriptions\nare called 'watches' and allow clients to be notified whenever the state of a resource changes. It also\nenforces a strong role based access control (RBAC) on all resources, with granular permissions at the level of operation (Create/Retrieve/Update/Delete/Watch) per resource.")]),e._v(" "),n("p",[e._v("The basic architecture for Kubernetes worked so well for its developers that it was made available to third  party developers. Kubernetes now offers a mechanism for third parties to provide their own custom\nresource types that still leverqage CRUD support, event subscriptions and RBAC out of the box.\nThis mechanism is referred to as Custom Resources.")]),e._v(" "),n("p",[e._v("Custom Resources are most commonly used with Kubernetes Operators. Operators are Docker images that have been\ndeployed to Kubernetes Deployments. Generally, they observe a set of custom resources and perform some operations against\nthe Kubernetes API to reflect the state changes in the Custom Resource. We can say that Custom Resources are associated\nwith specific semantics in how they are translated in the cluster.")]),e._v(" "),n("p",[e._v("A new Custom Resource can be introduced into Kubernetes by registering a Custom Resource Definition (CRD). This is\njust another yaml or json resource that defines the structure of the custom resource to be installed using the OpenAPI\nJSON Schema format. When talking about Custom Resources, it is very important to distinguish between Custom Resource\nDefinitions and Custom Resources. CRD's are static type definitions provided by an Operator\nprovider such as Entando. For those familiar with programming languages, CRD's are like class definitions, whereas\nCustom Resources are actual instances of that class.")]),e._v(" "),n("p",[e._v("Entando introduces two groups of Custom Resources.")]),e._v(" "),n("ul",[n("li",[e._v("Core Custom Resources required\nfor a basic installation of Entando in a Kubernetes cluster. These directly result in other\nKubernetes resources being deployed in the cluster.")]),e._v(" "),n("li",[e._v("Custom Resources specific\nto the Entando Component Repository that serve primarily as metadata for other Entando components.")])]),e._v(" "),n("h2",{attrs:{id:"the-core-entando-custom-resources"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#the-core-entando-custom-resources"}},[e._v("#")]),e._v(" The Core Entando Custom Resources")]),e._v(" "),n("p",[e._v("The Entando Operator observes all the Core Entando Custom Resources in one or more namespaces. If a Core\nEntando Custom Resource is created, updated or deleted, the Entando Operator will trigger a new run-to-completion Pod\nthat will translate that state change into a state change in the actual Kubernetes Cluster. Often, this will\nresult in the Deployment of one or more Docker images, along with one or more Services, and sometimes an Ingress. We refer to the Docker Images that implement these run-to-completion Pods as Entando Kubernetes Controllers.")]),e._v(" "),n("p",[e._v("The Entando Operator itself is also implemented as a Docker image. See the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando-k8s-controller-coordinator repo"),n("OutboundLink")],1),e._v(" for details.")]),e._v(" "),n("p",[e._v("More detailed instructions on how to install Entando are available in our\n"),n("a",{attrs:{href:"../getting-started"}},[e._v("Getting Started tutorial")]),e._v(". Learn more about "),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/entando-operator.html"}},[e._v("Configuring the Operator here")]),e._v(".")],1),e._v(" "),n("h2",{attrs:{id:"the-resourcerequirements-specification"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#the-resourcerequirements-specification"}},[e._v("#")]),e._v(" The ResourceRequirements specification")]),e._v(" "),n("p",[e._v("All of the Entando Custom Resources that result in physical Kubernetes Deployments can be configured with specific\nresource requirements. These settings can be provided under the "),n("code",[e._v("spec")]),e._v(" object of the custom resource. It currently\nsupports the following attributes:")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("spec.resourceRequirements.storageRequest")]),e._v(" - the initial storage requested from the persistence provider. Please keep\nin mind that resizable storage is not supported by all storage providers, and this may be the final size of the storage\nallocated.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.storageLimit")]),e._v(" - the maximum amount of storage required by the deployment.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.memoryRequest")]),e._v(" - the initial memory requested from the node the deployment's primary container is running on.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.memoryLimit")]),e._v(" - the maximum amount of memory the deployment's primary container will use. If\nit exceeds this amount, the container may be terminated by Kubernetes.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.cpuRequest")]),e._v(" - the initial CPU allocation from the node the deployment's primary container is running on.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.cpuLimit")]),e._v(" - the maximum CPU allocation for the deployment's primary container.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements.fileUploadLimit")]),e._v("  - the maximum upload file size supported by the deployment.")])]),e._v(" "),n("p",[e._v('All of these attributes require a number and a unit of measurement, e.g. "64Mi". Please consult the\n'),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-requests-and-limits-of-pod-and-container",target:"_blank",rel:"noopener noreferrer"}},[e._v("official Kubernetes documentation"),n("OutboundLink")],1),e._v("\nfor more information on how to configure these attributes.")]),e._v(" "),n("h2",{attrs:{id:"entandokeycloakserver"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entandokeycloakserver"}},[e._v("#")]),e._v(" EntandoKeycloakServer")]),e._v(" "),n("p",[e._v("The EntandoKeycloakServer Custom Resource is used to deploy and configure a Red Hat Keycloak Server instance on the\ncluster. After deploying this Keycloak instance, the Entando Operator will create a Kubernetes Secret that provides\nthe necessary information for subsequent deployment operations to access the Keycloak instance as the Admin user. This\nallows the rest of the Entando Kubernetes Controllers to create a Keycloak OpenID Connect (OIDC) client for every HTTP service that\ngets deployed. If you already have a Keycloak instance that you want to use, you can skip this custom resource entirely and create the "),n("code",[e._v("keycloak-admin-secret")]),e._v(" in the operator's namespace as specified in the\n"),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/external-id-management.html"}},[e._v("external Keycloak tutorial")]),e._v(".")],1),e._v(" "),n("h3",{attrs:{id:"overview-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview-2"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),n("ul",[n("li",[e._v("Entando Cluster Citizen: "),n("RouterLink",{attrs:{to:"/v7.0/docs/getting-started/concepts-overview.html#entando-cluster-citizens"}},[e._v("Keycloak")])],1),e._v(" "),n("li",[e._v("Custom Resource Definition: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-custom-model/blob/v7.0.0/src/main/resources/crd/entandokeycloakservers.entando.org.crd.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("EntandoKeycloakServer"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Kubernetes Controller Details:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-k8s-keycloak-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-keycloak-controller"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-keycloak-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando-k8s/entando-k8s-keycloak-controller"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[e._v("Deployment Details:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-keycloak",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-keycloak"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando/entando-keycloak",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-keycloak"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[e._v("Possible Database Images:\n"),n("ul",[n("li",[e._v("MySQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/mysql-57-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/mysql-57-centos7"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("PostgreSQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/postgresql-96-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/postgresql-96-centos7"),n("OutboundLink")],1)])])])]),e._v(" "),n("h3",{attrs:{id:"example"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[e._v("#")]),e._v(" Example")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('---\nkind: "EntandoKeycloakServer"\napiVersion: "entando.org/v1"\nmetadata:\n  name: "test-keycloak"\n  namespace: "keycloak-namespace"\nspec:\n  dbms: "postgresql"\n  imageName: "entando/entando-keycloak"\n  ingressHostName: "test-keycloak.ampie.dynu.net"\n  isDefault: true\n  environmentVariables: \n    - name: KEYCLOAK_WELCOME_THEME\n      value: your-custom-theme\n  tlsSecretName: your-tls-secret\n  replicas: 1\n  \n')])])]),n("h3",{attrs:{id:"explanation-of-properties"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explanation-of-properties"}},[e._v("#")]),e._v(" Explanation of properties")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("spec.dbms")]),e._v(" is used to select the database management of choice. The Entando Operator will use this value to deploy a dedicated Database instance in this namespace\nfor Keycloak to use. If this value matches the "),n("code",[e._v("spec.dbms")]),e._v(" property\nof a previously  configured "),n("a",{attrs:{href:"../../tutorials/devops/external-db"}},[e._v("EntandoDatabaseService")]),e._v(",\nthe Keycloak image will be configured to use this service.\nIf left empty or given a value of 'none', Keycloak will deploy using its own internal\nH2 database.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.imageName")]),e._v(" is used to provide a customized image. By default, the operator will use the "),n("code",[e._v("entando/entando-keycloak")]),e._v("\ndiscussed above. When using the default image, please refer to the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator/blob/master/charts/entando-k8s-controller-coordinator/README.md#how-it-resolves-docker-images",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker image section"),n("OutboundLink")],1),e._v("\nin the README of the Entando Operator to determine how the Docker registry and version for the image is calculated.\nWhen you need to customize the theme or add extensions to Keycloak, you can create your own custom image and provide\nthe value in this property. Make sure you use the default image ("),n("code",[e._v("entando/entando-keycloak")]),e._v(")\nas a base image. You can then add your customizations and build your own. Please use a fully qualified\nDocker image name here.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.ingressHostName")]),e._v(" is the hostname of the Kubernetes Ingress to be created for Keycloak. Please ensure that this is\naccessible using the default routing suffix of your Entando Operator Deployment or a DNS name previously\nregistered with your DNS provider.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.isDefault")]),e._v(" is 'true' by default and this should suffice for most conditions. This will result in the standard\n"),n("code",[e._v("keycloak-admin-secret")]),e._v(" being replaced by a Secret connecting you to this newly created Keycloak instance.\nTheoretically one could use multiple Keycloak instances in a cluster, in which case this property should be false.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.environmentVariables")]),e._v(" is a Map of environment variables to pass to the Keycloak Docker image. For example, this could\nbe used to select a specific theme for Keycloak with the variable KEYCLOAK_WELCOME_THEME. These parameters\nare applied to the container's environment variables after all variables have been calculated. It can therefore\nalso be used as a mechanism to override any of the default environment variables that need customization.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.tlsSecretName")]),e._v(" is the name of a standard Kubernetes\n"),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("TLS Secret"),n("OutboundLink")],1),e._v(" that will be used for the\nresulting Ingress. This is only required if the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator/blob/master/charts/entando-k8s-controller-coordinator/README.md#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("globally configured TLS Secret"),n("OutboundLink")],1),e._v("\nfor the Operator is absent or has not been created with a wildcard hostname that supports this Keycloak instance's hostname.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.replicas")]),e._v(" - the number of replicas to be made available on the Deployment of this Keycloak Server.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.resourceRequirements")]),e._v(" - the minimum and maximum "),n("a",{attrs:{href:"#the-resourcerequirements-specification"}},[e._v("resource allocations")]),e._v(" for the Keycloak server container.")])])]),e._v(" "),n("h2",{attrs:{id:"entandoapp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entandoapp"}},[e._v("#")]),e._v(" EntandoApp")]),e._v(" "),n("p",[e._v("An EntandoApp is a Deployment of a Docker image that hosts an Entando and Java based web application. Entando offers two\nstandard images that can be used, but generally we expect our customers to provide their images here. An EntandoApp\ndeployment packages three images into a single Pod: the EntandoApp image discussed here, AppBuilder, and Component Manager.")]),e._v(" "),n("h3",{attrs:{id:"overview-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview-3"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),n("ul",[n("li",[e._v("Kubernetes Controller Details:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-k8s-app-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-app-controller"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-app-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-app-controller"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[e._v("Deployment Details - Entando App:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-de-app-wildfly",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-de-app-wildfly"),n("OutboundLink")],1),e._v(" "),n("strong",[e._v("or")]),e._v(" "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-de-app-eap",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-de-app-eap"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando/entando-de-app",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando-k8s/entando-de-app"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Entando Cluster Citizen: "),n("RouterLink",{attrs:{to:"/v7.0/docs/getting-started/concepts-overview.html#entando-cluster-citizens"}},[e._v("Entando App")])],1)])]),e._v(" "),n("li",[e._v("Deployment Details - AppBuilder:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/app-builder",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/app-builder"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando/app-builder",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/app-builder"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[e._v("Deployment Details - ComponentManager:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-component-manager",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-component-manager"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-component-manager",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando-k8s/entando-component-manager"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Entando Cluster Citizen: "),n("RouterLink",{attrs:{to:"/v7.0/docs/getting-started/concepts-overview.html#entando-cluster-citizens"}},[e._v("Component Manager")])],1)])]),e._v(" "),n("li",[e._v("Possible Database Images:\n"),n("ul",[n("li",[e._v("MySQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/mysql-57-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/mysql-57-centos7"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("PostgreSQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/postgresql-96-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/postgresql-96-centos7"),n("OutboundLink")],1)])])])]),e._v(" "),n("h3",{attrs:{id:"example-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-2"}},[e._v("#")]),e._v(" Example")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('---\nkind: "EntandoApp"\napiVersion: "entando.org/v1"\nmetadata:\n  name: "test-app"\n  namespace: "your-namespace"\nspec:\n  standardServerImage: wildfly\n  customServerImage: your-org/your-image:4.3.2\n  dbms: "postgresql"\n  ingressPath: your-app\n  ingressHostName: "test-app.your-routing-suffix.com"\n  environmentVariables: \n    - name: ENTANDO_VAR1\n      value: your-var1\n  tlsSecretName: your-tls-secret\n  replicas: 1\n  ecrGitSshSecretName: your-secret\n  storageClass: standard\n  \n')])])]),n("h3",{attrs:{id:"explanation-of-properties-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explanation-of-properties-2"}},[e._v("#")]),e._v(" Explanation of properties")]),e._v(" "),n("ul",[n("li",[n("p",[n("code",[e._v("spec.standardServerImage")]),e._v(" can be either"),n("code",[e._v("wildfly")]),e._v(" or "),n("code",[e._v("eap")]),e._v(". This instructs the Entando Operator to use one of the\ntwo standard Entando App images.")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("wildfly")]),e._v(" will deploy the "),n("code",[e._v("entando/entando-de-app-wildfly")]),e._v(" image")]),e._v(" "),n("li",[n("code",[e._v("eap")]),e._v(" will deploy the "),n("code",[e._v("entando/entando-de-app-eap")]),e._v(" image")])]),e._v(" "),n("p",[e._v("This property and the "),n("code",[e._v("spec.customServerImage")]),e._v(" are  assumed to be mutually exclusive. Only provide a value to\none of the two. Please refer to the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator/blob/master/charts/entando-k8s-controller-coordinator/README.md#how-it-resolves-docker-images",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker image section"),n("OutboundLink")],1),e._v("\nin the README of the Entando Operator to determine how the Docker registry and version of these images are calculated.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.customServerImage")]),e._v(" can be used to deploy the Docker image containing your own custom Entando App. Please\nfollow the instructions on how to "),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/build-core-image.html"}},[e._v("build your own image")]),e._v("."),n("br"),e._v("\nThis property and the "),n("code",[e._v("spec.standardServerImage")]),e._v(" are  assumed to be mutually exclusive. Only provide a\nvalue to one of the two.")],1)]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.dbms")]),e._v(" is used to select the database management of choice. If left empty, a default value of "),n("code",[e._v("postgresql")]),e._v("\nis assumed. The value "),n("code",[e._v("none")]),e._v(" is not supported. The Entando Operator will use this value to deploy a dedicated Database instance in this namespace\nfor the EntandoApp to use. If this value matches the "),n("code",[e._v("spec.dbms")]),e._v(" property\nof a previously configured "),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/external-db.html"}},[e._v("EntandoDatabaseService")]),e._v(",\nthe Entando App will be configured to use this service.")],1)]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.ingressPath")]),e._v(" specifies the web context of the Entando App to be deployed. This is required to create a single\npath entry in the Ingress that is used to expose the Entando App. The default behaviour of Wildfly and\nJBoss EAP is to use the name of the WAR file that is deployed, but it is possible to override this in the EntandoApp\nproject using a "),n("a",{attrs:{href:"https://docs.jboss.org/jbossas/guides/webguide/r2/en/html/ch06.html",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("jboss-web.xml")]),e._v(" file"),n("OutboundLink")],1),e._v(".\nIn the absence of this file, the web context would be the\nMaven artifactId of the Entando App project. It is also possible to modify this by changing the "),n("code",[e._v("<finalName>")]),e._v(" element\nin the Maven "),n("code",[e._v("pom.xml")]),e._v(".")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.ingressHostName")]),e._v(" is the hostname of the Kubernetes Ingress to be created for the Entando App. Please\nensure that this is accessible using the default routing suffix of your Entando Operator Deployment or a DNS\nname previously registered with your DNS provider. Keep in mind that EntandoPlugins linked to this app will\nalso be made available on this host.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.environmentVariables")]),e._v(" is a Map of environment variables to pass to the EntandoApp Docker image. For example, this could\nbe used to provide connection details for custom datasources or message queues as discussed in the\n"),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/change-default-datasource.html"}},[e._v("custom datasources tutorial")]),e._v(". Also note that all of the\n"),n("a",{attrs:{href:"https://github.com/entando/entando-de-app/blob/master/src/main/conf/systemParams.properties",target:"_blank",rel:"noopener noreferrer"}},[e._v("Spring variables in an Entando project"),n("OutboundLink")],1),e._v("\ncan also be overridden here by specifying the equivalent SNAKE_CASE names of the dot-delimited Spring properties.\nThese parameters are applied to the container's environment variables after all variables have been calculated.\nIt can therefore also be used as a mechanism to override any of the default environment variables that need customization.\nKeep in mind that these parameters will be passed to each of the three containers in this Pod as environment\nvariables, and that care needs to be taken to avoid conflicting variable names.")],1)]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.tlsSecretName")]),e._v(" is the name of a standard Kubernetes\n"),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("TLS Secret"),n("OutboundLink")],1),e._v(" that will be used for the\nresulting Ingress. This is only required if the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator/blob/master/charts/entando-k8s-controller-coordinator/README.md#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("globally configured TLS Secret"),n("OutboundLink")],1),e._v("\nfor the Operator is absent or has not been created with a wildcard hostname that supports this Keycloak instance's hostname.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.replicas")]),e._v(" - the number of replicas to be made available on the Deployment of this Entando App.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.resourceRequirements")]),e._v(" - the minimum and maximum "),n("a",{attrs:{href:"#the-resourcerequirements-specification"}},[e._v("resource allocation")]),e._v(" for the Entando App Engine container.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.ecrGitSshSecretName")]),e._v(" - a secret containing a private key file named "),n("code",[e._v("rsa_id")]),e._v(" that matches a public key configured in the Git server.")])]),e._v(" "),n("li",[n("p",[n("code",[e._v("spec.storageClass")]),e._v(" - the name of the StorageClass to use for PersistentVolumeClaims created for this EntandoApp. For more information, go to "),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes explanation on Storage Classes"),n("OutboundLink")],1),e._v(".")])])]),e._v(" "),n("h2",{attrs:{id:"entandoplugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entandoplugin"}},[e._v("#")]),e._v(" EntandoPlugin")]),e._v(" "),n("p",[e._v("An Entando Plugin is a microservice that can be made available to one or more EntandoApps in the cluster. Please follow\nour instructions on using our blueprint to "),n("RouterLink",{attrs:{to:"/v7.0/tutorials/create/pb/publish-project-bundle.html"}},[e._v("build your own EntandoPlugin")]),e._v(". The\nDeployment resulting from an EntandoPlugin is a single-container Pod deployment and will include the\nplugin Docker image specified.")],1),e._v(" "),n("h3",{attrs:{id:"overview-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview-4"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),n("ul",[n("li",[e._v("Kubernetes Controller Details:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-k8s-plugin-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-plugin-controller"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-plugin-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-plugin-controller"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[e._v("Deployment Details - plugin:\n"),n("ul",[n("li",[e._v("Docker image: as provided by user")]),e._v(" "),n("li",[e._v("Entando Cluster Citizen: "),n("RouterLink",{attrs:{to:"/v7.0/docs/getting-started/concepts-overview.html#entando-cluster-citizens"}},[e._v("Plugin")])],1)])]),e._v(" "),n("li",[e._v("Possible Database Images:\n"),n("ul",[n("li",[e._v("MySQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/mysql-57-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/mysql-57-centos7"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("PostgreSQL: "),n("a",{attrs:{href:"https://hub.docker.com/r/centos/postgresql-96-centos7",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker.io/centos/postgresql-96-centos7"),n("OutboundLink")],1)])])])]),e._v(" "),n("h3",{attrs:{id:"example-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-3"}},[e._v("#")]),e._v(" Example")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('---\nkind: "EntandoPlugin"\napiVersion: "entando.org/v1"\nmetadata:\n  name: "test-plugin"\n  namespace: "your-namespace"\nspec:\n  image: your-org/your-image:4.3.2\n  securityLevel: lenient\n  ingressPath: /your-plugin\n  healthCheckPath: /actuator/health\n  dbms: "postgresql"\n  ingressHostName: "test-app.your-routing-suffix.com"\n  roles:\n    - code: admin\n      name: Administrators\n    - code: user\n      name: Users\n  permissions: \n    - clientId: some-keycloak-client \n      role: some-admin\n    - clientId: another-keycloak-client \n      role: another-admin\n  environmentVariables: \n    - name: ENTANDO_VAR1\n      value: your-var1\n  tlsSecretName: your-tls-secret\n  replicas: 1\n')])])]),n("h3",{attrs:{id:"explanation-of-properties-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explanation-of-properties-3"}},[e._v("#")]),e._v(" Explanation of properties")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("spec.image")]),e._v(" is the Docker image you can provide for the plugin you want to deploy. Please follow\nour instructions on using our blueprint to "),n("RouterLink",{attrs:{to:"/v7.0/tutorials/create/pb/publish-project-bundle.html"}},[e._v("build your own EntandoPlugin")]),e._v(".\nIf you start with the Entando Blueprint, the resulting Spring Boot application will make use of the environment variables set by the Entando Operator.")],1),e._v(" "),n("li",[n("code",[e._v("spec.dbms")]),e._v(" is used to select the database management of choice. The Entando Operator will use this value to deploy a dedicated Database instance in this namespace\nfor the Entando Plugin to use. If left empty or if the value is "),n("code",[e._v("none")]),e._v(", it\nis assumed that the plugin in question does not require a database. If this value matches\nthe "),n("code",[e._v("spec.dbms")]),e._v(" property  of a previously  configured\n"),n("RouterLink",{attrs:{to:"/v7.0/tutorials/devops/external-db.html"}},[e._v("EntandoDatabaseService")]),e._v(",\nthe Entando Plugin will be configured to use this service.")],1),e._v(" "),n("li",[n("code",[e._v("spec.ingressPath")]),e._v(" specifies the web context where the Entando Plugin will be made available when linked to EntandoApps.\nPlease ensure this is in sync with the "),n("code",[e._v("server.servlet.context-path")]),e._v(" property set in your Spring Boot application.")]),e._v(" "),n("li",[n("code",[e._v("spec.ingressHostName")]),e._v(" is the hostname of the Kubernetes Ingress to be created for the Entando Plugin. Please\nensure that this is accessible using the default routing suffix of your Entando Operator Deployment or a DNS\nname previously registered with your DNS provider. This hostname will not be used from your Widgets that you\nimplemented for this plugin, as these widgets will use the hostname of the EntandoApp they are used from.\nThis hostname is useful for embedded web user interfaces in this plugin, such as admin user interfaces\nor diagnostic user interface.")]),e._v(" "),n("li",[n("code",[e._v("spec.roles")]),e._v(" specifies the set of roles that this plugin expects. At deployment time, the Entando Operator ensures\nthat each of these roles are created on Keycloak for the Keycloak client representing this EntandoPlugin. It is\nup to the Plugin provider to ensure that Spring Security has been set up to enforce the access rules implied\nby the individual roles. Each role has a unique "),n("code",[e._v("code")]),e._v(" and a more human readable  "),n("code",[e._v("name")]),e._v(" as a property.")]),e._v(" "),n("li",[n("code",[e._v("spec.permissions")]),e._v(" specifies the set of permissions this plugin requires on other services with known Keycloak Clients.\nAt deployment time, the Entando Operator will use the service account user of this EntandoPlugin's Keycloak Client\nand create the necessary role bindings on the specified client id of the service to be used.\nEach permission specifies the "),n("code",[e._v("clientId")]),e._v(" in Keycloak of the target service, and the "),n("code",[e._v("role")]),e._v(" that this EntandoPlugin\nshould be bound to in that Keycloak client.")]),e._v(" "),n("li",[n("code",[e._v("spec.environmentVariables")]),e._v(" is a Map of environment variables to pass to the EntandoPlugin Docker image.\nIt is entirely up to the plugin provider to determine the semantics of each variable. We strongly suggest for the\nplugin provider to use the standard Spring Property Resolver syntax for Spring variables, as this would allow\nany of these variables to be overridden here by specifying the equivalent SNAKE_CASE names of the dot-delimited\nSpring properties.\nThese parameters are applied to the container's environment variables after all variables have been calculated.\nIt can therefore also be used as a mechanism to override any of the default environment variables that need customization.\nKeep in mind that these parameters will be passed to both containers in this Pod as environment\nvariables, and that care needs to be taken to avoid conflicting variable names.")]),e._v(" "),n("li",[n("code",[e._v("spec.tlsSecretName")]),e._v(" is the name of a standard Kubernetes\n"),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("TLS Secret"),n("OutboundLink")],1),e._v(" that will be used for the\nresulting Ingress. This is only required if the\n"),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-controller-coordinator/blob/master/charts/entando-k8s-controller-coordinator/README.md#tls",target:"_blank",rel:"noopener noreferrer"}},[e._v("globally configured TLS Secret"),n("OutboundLink")],1),e._v("\nfor the Operator is absent or has not been created with a wildcard hostname that supports this Keycloak instance's hostname.")]),e._v(" "),n("li",[n("code",[e._v("spec.replicas")]),e._v(" - the number of replicas to be made available on the Deployment of this Entando Plugin.")]),e._v(" "),n("li",[n("code",[e._v("spec.resourceRequirements")]),e._v(" - the minimum and maximum "),n("a",{attrs:{href:"#the-resourcerequirements-specification"}},[e._v("resource allocation")]),e._v(" for the Entando Plugin container.")])]),e._v(" "),n("h2",{attrs:{id:"entandoapppluginlink"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entandoapppluginlink"}},[e._v("#")]),e._v(" EntandoAppPluginLink")]),e._v(" "),n("p",[e._v("The EntandoAppPluginLink custom resource is created when an AppBuilder user links an EntandoPlugin to the current\nEntandoApp or deploys an EntandoPlugin for use in the current EntandoApp. The Entando Operator processes the resulting\nEntandoAppPluginLink and creates a path for the Plugin on the Ingress that exposes the EntandoApp in question. This path\nis determined by the "),n("code",[e._v("spec.ingressPath")]),e._v(" property on the EntandoPlugin custom resource itself. If the EntandoPlugin\nresides in a namespace other than the namespace of the EntandoApp, the EntandoOperator creates a Kubernetes\nService in the namespace of the EntandoApp that simply delegates to the Service in the namespace of the EntandoPlugin.")]),e._v(" "),n("h3",{attrs:{id:"overview-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#overview-5"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),n("ul",[n("li",[e._v("Kubernetes Controller Details:\n"),n("ul",[n("li",[e._v("Docker image: "),n("a",{attrs:{href:"https://hub.docker.com/r/entando/entando-k8s-app-plugin-link-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-app-plugin-link-controller"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Github Repo: "),n("a",{attrs:{href:"https://github.com/entando-k8s/entando-k8s-app-plugin-link-controller",target:"_blank",rel:"noopener noreferrer"}},[e._v("entando/entando-k8s-app-plugin-link-controller"),n("OutboundLink")],1)])])])]),e._v(" "),n("h3",{attrs:{id:"example-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-4"}},[e._v("#")]),e._v(" Example")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('---\nkind: "EntandoAppPluginLink"\napiVersion: "entando.org/v1"\nmetadata:\n  name: "test-link"\n  namespace: "your-namespace"\nspec:\n  entandoAppName: your-app\n  entandoAppNamespace: your-namespace\n  entandoPluginName: your-app\n  entandoPluginNamespace: your-namespace\n\n')])])]),n("h3",{attrs:{id:"explanation-of-properties-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explanation-of-properties-4"}},[e._v("#")]),e._v(" Explanation of properties")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("spec.entandoAppName")]),e._v(" specifies the name of the EntandoApp that requires the plugin, found in "),n("code",[e._v("EntandoApp.metadata.name")])]),e._v(" "),n("li",[n("code",[e._v("spec.entandoAppNamespace")]),e._v(" specifies the namespace of the EntandoApp that requires the plugin, found in "),n("code",[e._v("EntandoApp.metadata.namespace")])]),e._v(" "),n("li",[n("code",[e._v("spec.entandoPluginName")]),e._v(" specifies the name of the EntandoApp that requires the plugin, found in "),n("code",[e._v("EntandoPlugin.metadata.name")])]),e._v(" "),n("li",[n("code",[e._v("spec.entandoPluginNamespace")]),e._v(" specifies the namespace of the EntandoApp that requires the plugin, found in "),n("code",[e._v("EntandoPlugin.metadata.namespace")])])]),e._v(" "),n("h2",{attrs:{id:"entandodatabaseservice"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entandodatabaseservice"}},[e._v("#")]),e._v(" EntandoDatabaseService")]),e._v(" "),n("p",[e._v("By default, the Entando Operator deploys one of either the MySQL or PostgreSQL database Docker images for every custom\nresource that requires a database. Many customers may, however, have existing infrastructure for their databases which\nthey may want to leverage. The EntandoDatabaseService custom resource allows customers to deploy a Service that points\nto an external database. When deploying one of the Entando Custom Resources that require a database, the Entando\nOperator will look for EntandoDatabases in the same namespace. If it finds one with the same "),n("code",[e._v("spec.dbms")]),e._v(" setting\nas the database required by the custom resource, it will create a dedicated schema/username/password combination\nfor the custom resource and point the deployment emanating from Custom Resources to this external database.")]),e._v(" "),n("h3",{attrs:{id:"example-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#example-5"}},[e._v("#")]),e._v(" Example")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('---\nkind: "EntandoDatabaseService"\napiVersion: "entando.org/v1"\nmetadata:\n  name: "test-database-service"\n  namespace: "your-namespace"\nspec:\n  dbms: "oracle"\n  host: 10.0.12.41\n  port: 1521\n  databaseName: yourdb \n  tablespace: \n  secretName: some-secret\n  jdbcParameters:\n    maxStatements: 300 \n    loginTimeout: 180\n')])])]),n("h3",{attrs:{id:"explanation-of-properties-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#explanation-of-properties-5"}},[e._v("#")]),e._v(" Explanation of properties")]),e._v(" "),n("ul",[n("li",[n("code",[e._v("spec.dbms")]),e._v(" is used to select the database management of choice if this value matches the "),n("code",[e._v("spec.dbms")]),e._v(" property\nof the Entando custom resource that will use it. Valid values are "),n("code",[e._v("oracle")]),e._v(", "),n("code",[e._v("postgresql")]),e._v(" and "),n("code",[e._v("mysql")]),e._v(".")]),e._v(" "),n("li",[n("code",[e._v("spec.host")]),e._v(" can either be a valid IPv4 address or a hostname. Where an IP address is provided, the Entando Operator\nwill create a Kubernetes Service with an associated EndPoints resource to allow for routing to this address. Where\na hostname is provided, the Entando Operator will simply create a Kubernetes Service of type "),n("code",[e._v("cname")]),e._v(".")]),e._v(" "),n("li",[n("code",[e._v("spec.port")]),e._v(" is the port that the external database service is running on. This value is optional in which case we will\nuse the default port for the DBMS vendor in question.")]),e._v(" "),n("li",[n("code",[e._v("spec.databaseName")]),e._v(" is the name of the database that the Entando Operator should be creating schemas in. This property\nis only for use with PostgreSQL and Oracle, as MySQL doesn't distinguish between schemas and databases.")]),e._v(" "),n("li",[n("code",[e._v("spec.tablespace")]),e._v(" is only required for Oracle so that Schemas can be created in different tablespaces.")]),e._v(" "),n("li",[n("code",[e._v("spec.secretName")]),e._v(" should be the name ("),n("code",[e._v("Secret.metadata.name")]),e._v(") of a Kubernetes Secret in the same namespace that has\na "),n("code",[e._v("username")]),e._v(" key and a "),n("code",[e._v("password")]),e._v(" key to provide the Entando Operator with the necessary access and permissions\nto create Schemas and users on the database in question.")]),e._v(" "),n("li",[n("code",[e._v("spec.jdbcParameters")]),e._v(" is a map of name/value pairs that will be appended to the JDBC connection string to allow for\nfurther customization of the actual connection to the database.")])])])}),[],!1,null,null,null);t.default=o.exports}}]);